generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  USER
}

enum JobStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum PaymentMethod {
  PIX
  CASH
  CREDIT_CARD
  DEBIT_CARD
}

enum PaymentStatus {
  NOT_PAID
  PARTIALLY_PAID
  PAID
}

model User {
  id            String      @id @default(uuid())
  name          String
  email         String      @unique
  passwordHash  String
  role          UserRole    @default(ADMIN)

  profileImage  String?
  bannerImage   String?

  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  refreshToken  String?

  enterprise    Enterprise?
}

model Enterprise {
  id          String      @id @default(uuid())
  name        String
  cnpj        String?
  email       String?
  phone       String?
  logo        String?

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  ownerId     String      @unique
  owner       User        @relation(fields: [ownerId], references: [id])

  employees   Employee[]
  clients     Client[]
  jobs        Job[]
}

model Client {
  id            String      @id @default(uuid())
  name          String
  cpfCnpj       String
  phone         String
  email         String?
  street        String
  number        String
  district      String
  city          String
  state         String
  cep           String
  reference     String?

  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  enterpriseId  String
  enterprise    Enterprise @relation(fields: [enterpriseId], references: [id])

  jobs          Job[]
}

model Employee {
  id            String      @id @default(uuid())
  name          String
  role          String?
  phone         String?
  email         String?
  salary        Float?

  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  enterpriseId  String
  enterprise    Enterprise @relation(fields: [enterpriseId], references: [id])

  jobs          Job[]
}

model Job {
  id              String      @id @default(uuid())
  title           String
  description     String

  quantity        Int?
  location        String?
  deadline        DateTime?
  estimatedValue  Float?
  finalValue      Float?

  status          JobStatus   @default(PENDING)

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  enterpriseId    String
  enterprise      Enterprise @relation(fields: [enterpriseId], references: [id])

  clientId        String
  client          Client     @relation(fields: [clientId], references: [id])

  employeeId      String?
  employee        Employee?  @relation(fields: [employeeId], references: [id])

  payments        Financial[]
}

model Financial {
  id              String          @id @default(uuid())
  method          PaymentMethod
  status          PaymentStatus   @default(NOT_PAID)
  dueDate         DateTime?
  paidAt          DateTime?
  receipt         String?

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  jobId           String
  job             Job             @relation(fields: [jobId], references: [id])
}
